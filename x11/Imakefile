XCOMM
XCOMM NP2
XCOMM

#include "config.tmpl"


XCOMM
XCOMM GUI Toolkit
XCOMM

#if !defined(DISABLE_GTK)
GTK_CONFIG?= gtk-config
GTK_DEFINE= -DUSE_GTK
GTK_INCLUDE= `$(GTK_CONFIG) --cflags`
GTK_LIB= `$(GTK_CONFIG) --libs`
#endif

#if defined(USE_QT)
QT_CONFIG?=
QT_DEFINE= -DUSE_QT
QT_INCLUDE=
QT_LIB=
#endif


XCOMM
XCOMM Audio
XCOMM

#if defined(USE_NETBSDAUDIO) && defined(NetBSDArchitecture)
SOUND_DEFINE+= -DUSE_NETBSDAUDIO
#endif

#if defined(USE_OSSAUDIO)
SOUND_DEFINE+= -DUSE_OSSAUDIO
#if defined(NetBSDArchitecture)
SYS_LIBRARIES+= -lossaudio
#endif /* NetBSDArchitecture */
#endif

#if defined(USE_SDLAUDIO) || defined(USE_SDLMIXER)
SOUND_DEFINE+= -DUSE_SDLAUDIO
SDL_CONFIG?= sdl-config
SDL_INCLUDE= `$(SDL_CONFIG) --cflags`
SDL_LIB= `$(SDL_CONFIG) --libs`
#if defined(USE_SDLMIXER)
CFLAGS+= -DUSE_SDLMIXER
SDL_LIB+= -lSDL_mixer
#endif
#endif

#if defined(USE_ESDAUDIO)
SOUND_DEFINE+= -DUSE_ESDAUDIO
ESD_CONFIG?= esd-config
ESD_INCLUDE= `$(ESD_CONFIG) --cflags`
ESD_LIB= `$(ESD_CONFIG) --libs`
#endif

#if (defined(USE_NETBSDAUDIO) && defined(NetBSDArchitecture)) || defined(USE_OSSAUDIO) || defined(USE_ESDAUDIO)
PTHREAD_INCLUDE?=
PTHREAD_LIB?= -lpthread
#endif


SYSRESPATH?= $(LIBDIR)/xnp2/font

DEFINES= ShmDefines \
	-DSYSRESPATH=\"$(SYSRESPATH)\" \
	$(SOUND_DEFINE) $(GTK_DEFINE) $(QT_DEFINE) \
	$(CPUFLAGS) 

SYS_LIBRARIES= -lm

EXTRA_INCLUDES= -I. -I.. -I../common -I../bios -I../cbus -I../fdd -I../font \
		-I../io -I../lio -I../sound -I../sound/vermouth -I../vram \
		$(PTHREAD_INCLUDE) $(GTK_INCLUDE) $(QT_INCLUDE) \
		$(SDL_INCLUDE) $(ESD_INCLUDE)

LOCAL_LIBRARIES= $(XLIB) \
		$(PTHREAD_LIB) $(GTK_LIB) $(QT_LIB) $(SDL_LIB) $(ESD_LIB)

#define PassCDebugFlags


CPUOBJS=	../i286c/i286c.o ../i286c/i286c_mn.o ../i286c/i286c_ea.o \
		../i286c/i286c_0f.o ../i286c/i286c_8x.o ../i286c/i286c_sf.o \
		../i286c/i286c_f6.o ../i286c/i286c_fe.o ../i286c/i286c_rp.o \
		../i286c/memory.o ../i286c/egcmem.o ../i286c/dmap.o \
		../i286c/v30patch.o

CPUFLAGS=	-I../i286c

COMMONOBJS=	../common/strres.o ../common/milstr.o ../common/_memory.o \
		../common/textfile.o ../common/profile.o ../common/rect.o \
		../common/lstarray.o ../common/bmpdata.o ../common/mimpidef.o \
		../common/codecnv.o ../common/parts.o ../common/wavefile.o

BIOSOBJS=	../bios/bios.o ../bios/bios02.o ../bios/bios08.o \
		../bios/bios09.o ../bios/bios0c.o ../bios/bios12.o \
		../bios/bios13.o ../bios/bios18.o ../bios/bios19.o \
		../bios/bios1a.o ../bios/bios1b.o ../bios/bios1c.o

CBUSOBJS=	../cbus/cbuscore.o ../cbus/pc9861k.o ../cbus/mpu98ii.o \
		../cbus/amd98.o ../cbus/board118.o ../cbus/board14.o \
		../cbus/board26k.o ../cbus/board86.o ../cbus/boardspb.o \
		../cbus/boardx2.o ../cbus/cs4231io.o ../cbus/pcm86io.o

FDDOBJS=	../fdd/diskdrv.o ../fdd/newdisk.o ../fdd/fddfile.o \
		../fdd/fdd_xdf.o ../fdd/fdd_d88.o ../fdd/fdd_mtr.o \
		../fdd/sxsi.o

FONTOBJS=	../font/font.o ../font/fontdata.o ../font/fontmake.o \
		../font/fontpc88.o ../font/fontpc98.o ../font/fontv98.o \
		../font/fontfm7.o ../font/fontx1.o ../font/fontx68k.o \

IOOBJS=		../io/iocore.o ../io/artic.o ../io/cgrom.o ../io/cpuio.o \
		../io/crtc.o ../io/dipsw.o ../io/dmac.o ../io/egc.o \
		../io/extmem.o ../io/fdc.o ../io/fdd320.o ../io/gdc.o \
		../io/gdc_sub.o ../io/gdc_pset.o ../io/itf.o ../io/mouseif.o \
		../io/nmiio.o ../io/np2sysp.o ../io/pic.o ../io/pit.o \
		../io/printif.o ../io/serial.o ../io/sysport.o ../io/upd4990.o

LIOOBJS=	../lio/lio.o ../lio/gscreen.o ../lio/gview.o ../lio/gcolor1.o \
		../lio/gcolor2.o ../lio/gcls.o ../lio/gpset.o ../lio/gline.o \
		../lio/gput1.o

NP2OBJS=	../pccore.o ../nevent.o ../calendar.o ../timing.o \
		../debugsub.o ../statsave.o

SOUNDOBJS=	../sound/sound.o ../sound/soundrom.o ../sound/s98.o \
		../sound/adpcmc.o ../sound/adpcmg.o \
		../sound/beepc.o ../sound/beepg.o \
		../sound/cs4231c.o ../sound/cs4231g.o \
		../sound/fmboard.o ../sound/fmtimer.o \
		../sound/opngenc.o ../sound/opngeng.o \
		../sound/pcm86c.o ../sound/pcm86g.o \
		../sound/psggenc.o ../sound/psggeng.o \
		../sound/rhythmc.o ../sound/rhythmg.o \
		../sound/sndcsec.o \
		../sound/tms3631c.o ../sound/tms3631g.o

VERMOUTHOBJS=	../sound/vermouth/midiout.o ../sound/vermouth/midimod.o \
		../sound/vermouth/midinst.o ../sound/vermouth/midvoice.o \
		../sound/vermouth/midtable.o

VRAMOBJS=	../vram/vram.o ../vram/scrndraw.o ../vram/sdraw.o \
		../vram/dispsync.o ../vram/palettes.o ../vram/maketext.o \
		../vram/maketgrp.o ../vram/makegrph.o ../vram/scrnbmp.o

X11OBJS=	dosio.o ini.o trace.o cmmidi.o np2.o toolkit.o \
		commng.o joymng.o soundmng.o sysmng.o taskmng.o timemng.o \
		main.o

SNDDRVOBJS=	snddrv/esd.o snddrv/netbsd.o snddrv/oss.o snddrv/sdl.o

#if !defined(DISABLE_GTK)
GTKDEPOBJS=	gtk/gtkdraw.o gtk/gtkfont.o gtk/gtkkeyboard.o \
		gtk/gtkmenu.o gtk/gtkmouse.o \
		gtk/dialog_about.o gtk/dialog_calendar.o gtk/dialog_config.o \
		gtk/dialog_file_selection.o gtk/dialog_midi.o \
		gtk/dialog_newdisk.o gtk/dialog_screen.o gtk/dialog_sound.o \
		gtk/gtkmain.o gtk/gtkwrapper.o
#endif

#if defined(USE_QT)
QTDEPOBJS=
#endif

OBJS=		$(COMMONOBJS) $(BIOSOBJS) $(CBUSOBJS) $(FDDOBJS) $(FONTOBJS) \
		$(IOOBJS) $(LIOOBJS) $(NP2OBJS) $(SOUNDOBJS) $(VERMOUTHOBJS) \
		$(VRAMOBJS) $(CPUOBJS) \
		$(X11OBJS) $(SNDDRVOBJS) $(GTKDEPOBJS) $(QTDEPOBJS)

CSRCS=		$(COMMONOBJS:.o=.c) $(BIOSOBJS:.o=.c) $(CBUSOBJS:.o=.c) \
		$(FDDOBJS:.o=.c) $(FONTOBJS:.o=.c) $(IOOBJS:.o=.c) \
		$(LIOOBJS:.o=.c) $(NP2OBJS:.o=.c) $(SOUNDOBJS:.o=.c) \
		$(VERMOUTHOBJS:.o=.c) $(VRAMOBJS:.o=.c) $(CPUOBJS:.o=.c) \
		$(SNDDRVOBJS=.o=.c) $(X11OBJS:.o=.c) \
		$(GTKDEPOBJS:.o=.c) $(QTDEPOBJS:.o=.c)
SRCS=		$(CSRCS)
ALLSRCS=	$(ASRCS) $(CSRCS)

.c.o:
	$(CC) -o $@ $(CFLAGS) $(_NOOP_) -c $<

ComplexProgramTarget(xnp2)

InstallMultipleFlags(resources/fddseek.wav, $(SYSRESPATH), $(INSTDATFLAGS))
InstallMultipleFlags(resources/fddseek1.wav, $(SYSRESPATH), $(INSTDATFLAGS))

clean::
	$(RM) $(OBJS)

cpuclean:
	$(RM) $(CPUOBJS)

distclean::
	$(RM) .depend
