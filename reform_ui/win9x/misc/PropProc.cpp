/**
 * @file	PropProc.cpp
 * @brief	プロパティ シート クラスの動作の定義を行います
 */

#include "compiler.h"
#include "PropProc.h"

/**
 * コンストラクタ
 * @param[in] nIDTemplate このページに使用するテンプレートの ID
 * @param[in] nIDCaption このページのタブに設定される名前の ID
 */
CPropPageProc::CPropPageProc(UINT nIDTemplate, UINT nIDCaption)
{
	Construct(MAKEINTRESOURCE(nIDTemplate), nIDCaption);
}

/**
 * コンストラクタ
 * @param[in] lpszTemplateName このページのテンプレートの名前を含む文字列へのポインター
 * @param[in] nIDCaption このページのタブに設定される名前の ID
 */
CPropPageProc::CPropPageProc(LPCTSTR lpszTemplateName, UINT nIDCaption)
{
	Construct(lpszTemplateName, nIDCaption);
}

/**
 * デストラクタ
 */
CPropPageProc::~CPropPageProc()
{
}

/**
 * コンストラクト
 * @param[in] nIDTemplate このページに使用するテンプレートの ID
 * @param[in] nIDCaption このページのタブに設定される名前の ID
 */
void CPropPageProc::Construct(UINT nIDTemplate, UINT nIDCaption)
{
	Construct(MAKEINTRESOURCE(nIDTemplate), nIDCaption);
}

/**
 * コンストラクト
 * @param[in] lpszTemplateName このページのテンプレートの名前を含む文字列へのポインター
 * @param[in] nIDCaption このページのタブに設定される名前の ID
 */
void CPropPageProc::Construct(LPCTSTR lpszTemplateName, UINT nIDCaption)
{
	ZeroMemory(&m_psp, sizeof(m_psp));
	m_psp.dwSize = sizeof(m_psp);
	m_psp.dwFlags = PSP_USECALLBACK;
	m_psp.hInstance = GetInstanceHandle();
	m_psp.pszTemplate = lpszTemplateName;
	m_psp.pfnDlgProc = DlgProc;
	m_psp.lParam = reinterpret_cast<LPARAM>(this);
	m_psp.pfnCallback = PropPageCallback;
}

/**
 * プロパティ ページ プロシージャ
 * @param[in] hWnd ウィンドウ ハンドル
 * @param[in] message メッセージ
 * @param[in] pPropPage このプロパティ シート ページのポインタ
 * @return 0
 */
UINT CALLBACK CPropPageProc::PropPageCallback(HWND hWnd, UINT message, LPPROPSHEETPAGE pPropPage)
{
	switch (message)
	{
		case PSPCB_CREATE:
			HookWindowCreate(reinterpret_cast<CPropPageProc*>(pPropPage->lParam));
			return TRUE;

		case PSPCB_RELEASE:
			UnhookWindowCreate();
			break;
	}
	return 0;
}

/**
 * フレームワークは、イベントがコントロールに発生する場合や、コントロールが一部の種類の情報を要求するコントロールを親ウィンドウに通知するために、このメンバー関数を呼び出します
 * @param[in] wParam メッセージがコントロールからそのメッセージを送信するコントロールを識別します
 * @param[in] lParam 通知コードと追加情報を含む通知メッセージ (NMHDR) の構造体へのポインター
 * @param[out] pResult メッセージが処理されたとき結果を格納するコードする LRESULT の変数へのポインター
 * @retval TRUE メッセージを処理した
 * @retval FALSE メッセージを処理しなかった
 */
BOOL CPropPageProc::OnNotify(WPARAM wParam, LPARAM lParam, LRESULT* pResult)
{
	NMHDR* pNMHDR = reinterpret_cast<NMHDR*>(lParam);

	// allow message map to override
	if (CDlgProc::OnNotify(wParam, lParam, pResult))
	{
		return TRUE;
	}

	// don't handle messages not from the page/sheet itself
	if (pNMHDR->hwndFrom != m_hWnd && pNMHDR->hwndFrom != ::GetParent(m_hWnd))
	{
		return FALSE;
	}

	// handle default
	switch (pNMHDR->code)
	{
		case PSN_APPLY:
			*pResult = OnApply() ? PSNRET_NOERROR : PSNRET_INVALID_NOCHANGEPAGE;
			break;

		case PSN_RESET:
			OnReset();
			break;

		default:
			return FALSE;   // not handled
	}

	return TRUE;    // handled
}

/**
 * このメンバー関数は、フレームワークによって OnKillActiveフレームワークがを呼び出した直後にユーザーが[OK]を選択するか、更新時に呼び出されます
 * @retval TRUE 変更が承認された
 * @retval FALSE 変更が承認されなかった
 */
BOOL CPropPageProc::OnApply()
{
	OnOK();
	return TRUE;
}

/**
 * このメンバー関数は、フレームワークによってユーザーが[キャンセル]を選択するときに呼び出されます。
 */
void CPropPageProc::OnReset()
{
	OnCancel();
}

/**
 * このメンバー関数は、フレームワークによって OnKillActiveフレームワークがを呼び出した直後にユーザーが[OK]を選択するか、更新時に呼び出されます
 */
void CPropPageProc::OnOK()
{
}

/**
 * このメンバー関数は、フレームワークで[キャンセル]ボタンが選択されたときに呼び出されます
 */
void CPropPageProc::OnCancel()
{
}
